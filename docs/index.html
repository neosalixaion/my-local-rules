<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω –≤ Clash</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; }
    input, button { padding: 10px; font-size: 16px; }
    #status { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>–î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω –≤ <code>my-local-rules.yaml</code></h2>
  <form id="domainForm">
    <input type="text" id="domainInput" placeholder="example.com" required />
    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
  </form>
  <div id="status"></div>

  <script>
    const token = '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'; // üîê –í—Å—Ç–∞–≤—å —Å–≤–æ–π GitHub Token
    const repo = 'neosalixaion/my-local-rules';
    const filePath = 'my-local-rules.yaml';

    document.getElementById('domainForm').onsubmit = async (e) => {
      e.preventDefault();
      const domain = document.getElementById('domainInput').value.trim();
      if (!domain) return;

      const status = document.getElementById('status');
      status.textContent = '‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';

      try {
        const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
          headers: { Authorization: `token ${token}` }
        });
        const data = await res.json();
        const content = atob(data.content);
        const newLine = `  - DOMAIN-SUFFIX,${domain},PROXY`;

        if (content.includes(newLine)) {
          status.textContent = `‚ö†Ô∏è ${domain} —É–∂–µ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ`;
          return;
        }

        const updated = content + '\n' + newLine;

        await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
          method: 'PUT',
          headers: { Authorization: `token ${token}` },
          body: JSON.stringify({
            message: `–î–æ–±–∞–≤–ª–µ–Ω ${domain}`,
            content: btoa(updated),
            sha: data.sha
          })
        });

        status.textContent = `‚úÖ ${domain} –¥–æ–±–∞–≤–ª–µ–Ω`;
        document.getElementById('domainInput').value = '';
      } catch (err) {
        console.error(err);
        status.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏';
      }
    };
  </script>
</body>
</html>

